"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function i(){var i=t(".qor-slideout > .qor-slideout__body"),e=t('[data-toggle="qor.activity"]');e.appendTo(i),i.find(".qor-page__body,.qor-page__header").appendTo(e.find("#activity-form"))}function e(i,o){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(o)&&o),this.init()}var o=window.Mustache,n="qor.activity",a=".qor-activity__lists";return e.prototype={constructor:e,init:function(){this.bind(),this.initTabs()},bind:function(){this.$element.on("click.qor.activity",".qor-activity__edit-button",this.click.bind(this)).on("submit.qor.activity","#activity-lists form",this.submit.bind(this)).on("click.qor.activity",".qor-activities__header button",this.tabClick.bind(this))},unbind:function(){this.$element.off("click.qor.activity").off("submit.qor.activity")},submit:function(i){var e=t(i.target),o=void 0,n=this,r=t("#activity-lists").data().noteTitle;return i.preventDefault(),o=e.serialize(),t.ajax(e.prop("action"),{method:e.prop("method"),data:o,dataType:"json",headers:{Accept:"application/json; charset=utf-8"}}).done(function(i){i.errors||(i.NoteTitle=r,e.is(".qor-activity__edit-note_form")&&(n.hideEditForm(e),e.find(".qor-activity__list-note").html(i.Note)),e.is(".qor-activity__new-note_form")&&(t(a).prepend(n.renderActivityList(i)),n.clearForm()))}),!1},renderActivityList:function(t){return o.render(e.ACTIVITY_LIST_TEMPLATE,t)},clearForm:function(){t('textarea[data-toggle="qor.redactor"]').redactor("code.set",""),t(".qor-activity__new-note_form").find('[name="QorResource.Content"],[name="QorResource.Note"]').val("")},click:function(i){var e=t(i.target),o=e.closest(".qor-activity__list");this.showEditForm(o),i.stopPropagation()},tabClick:function(i){var e=this,o=this.$element,n=t(i.target),r=n.data("id"),s=n.data("resource-url");n.is(".qor-tab__activity")&&n.hasClass("is-active")||(o.find(".qor-activities__content").hide(),o.find(r).show(),o.find(".qor-activities__header button").removeClass("is-active"),n.addClass("is-active"),s?t.ajax({url:s,method:"GET",dataType:"json",headers:{Accept:"application/json; charset=utf-8"},success:function(i){if(i.length){t(a).html("");for(var o=i.length-1;o>=0;o--)i[o].NoteTitle=t("#activity-lists").data().noteTitle,t(a).append(e.renderActivityList(i[o]))}t(a).find(".mdl-spinner").remove()}}):t(a).find(".mdl-spinner").remove())},showEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("show").addClass("hide"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("hide").addClass("show")},hideEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("hide").addClass("show"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("show").addClass("hide")},initTabs:function(){var i=this.$element.closest(".mdl-layout__content.qor-page");if(i.length){var e=t('[data-toggle="qor.activity"]');e.appendTo(i),i.find(".qor-page__body,.qor-page__header").appendTo(e.find("#activity-form"))}},destroy:function(){this.unbind(),this.$element.removeData(n)}},e.DEFAULTS={},e.ACTIVITY_LIST_TEMPLATE='<div class="qor-activity__list">\n            <form class="qor-activity__edit-note_form" action=[[ URL ]] method="POST">\n                <input type="hidden" name="QorResource.ID" value=[[ ID ]]>\n                <div class="qor-activity__list-title">\n                    <strong>[[ CreatorName ]]</strong> <span>[[ Action ]]</span>\n                </div>\n                <div class="qor-activity__list-date">\n                    [[ UpdatedAt ]]\n                </div>\n                <div class="qor-activity__list-content">[[ &Content ]]</div>\n                <div>\n                    <strong>[[ NoteTitle ]]</strong>\n                    <span class="qor-activity__list-note">[[ Note ]]</span>\n                    <a class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-button" href="#">\n                        <i class="material-icons md-18 qor-activity__edit-button">edit</i>\n                    </a>\n                    <div class="mdl-textfield mdl-js-textfield qor-activity__edit-feilds">\n                        <label class="mdl-textfield__label">[[ Note ]]</label>\n                        <input class="mdl-textfield__input" type="text" name="QorResource.Note" value="[[ Note ]]">\n                    </div>\n                    <button class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-save-button" type="submit"><i class="material-icons md-24">done</i></button>\n                </div>\n            </form>\n        </div>',e.plugin=function(i){return this.each(function(){var o,a=t(this),r=a.data(n);if(!r){if(/destroy/.test(i))return;a.data(n,r=new e(this,i))}"string"==typeof i&&t.isFunction(o=r[i])&&o.apply(r)})},t.fn.qorSliderAfterShow.qorActivityinit=i,t(function(){var i='[data-toggle="qor.activity"]';t(document).on("disable.qor.activity",function(o){e.plugin.call(t(i,o.target),"destroy")}).on("enable.qor.activity",function(o){e.plugin.call(t(i,o.target))}).triggerHandler("enable.qor.activity")}),e});