"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(o,n){this.$element=t(o),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(n)&&n),this.init()}var o="qor.collection.sortable",n="click."+o,i="> .qor-field__block > .qor-sortable__item",r=">.qor-sortable__button > .qor-sortable__button-change",d=">.qor-sortable__button > .qor-sortable__button-done",l=">.qor-field__block > .qor-sortable__item > .qor-sortable__change .qor-sortable__button-move",s="> .qor-sortable__change > .qor-sortable__action";return e.prototype={constructor:e,init:function(){this.bind(),this.initItemOrder()},bind:function(){this.$element.on(n,l,this.moveItem.bind(this)).on(n,d,this.finishMoveItem.bind(this)).on(n,r,this.startMoveItem.bind(this))},unbind:function(){this.$element.off(n,l).off(n,d).off(n,r)},initItemOrder:function(o){var n=this.$element.find(i).not(".is-delete,.qor-fieldset--new");if(n.length){var r=n.find(s).find(".qor-sortable__action-position"),d={},l=n.length,a=n.first().html(),c=void 0,f=void 0;r.length&&r.remove(),f||(c=a.match(/(\w+)\="(\S*\[\d+\]\S*)"/),c.length&&(c=c[2],f=c.match(/^(\S*)\[(\d+)\]([^\[\]]*)$/),f.length&&(f=f[1]))),n.each(function(){var n=t(this),i=n.find(s);d.itemTotal=l,d.itemIndex=parseInt(n.attr("order-index")),i.prepend('<select class="qor-sortable__action-position"></select>');for(var r=1;r<=l;r++){var a={},c=void 0;c=d.itemIndex+1==r,a=t.extend({},d,{selectorPosition:r,isSelected:c}),i.find("select").append(window.Mustache.render(e.OPTION_HTML,a))}if(o){var b=void 0,h=void 0,u=void 0,m=/\[\d+\]/.test(f),_=t(this).find('[name^="'+f+'"]');if(!_.length)return;_.each(function(){b=t(this).prop("name"),u=b.match(/\.\w+$/),h="["+d.itemIndex+"]",b=m?b.replace(/\[\d+\]\.\w+$/,""+h+u):b.replace(/\[\d+\]/,h),t(this).prop("name",b)})}n.data(d)})}},moveItem:function(e){var o=t(e.target).closest(".qor-sortable__item"),n=o.data().itemIndex,i=o.find(".qor-sortable__action-position").val()-1,r=this.$element.find('[order-index="'+i+'"]');i!=n&&(r.attr("order-index",n).css("order",n),o.attr("order-index",i).css("order",i),this.initItemOrder(!0))},finishMoveItem:function(e){var o=t(e.target),n=this.$element,d=n.find(i).not(".is-delete,.qor-fieldset--new"),l=n.find("> .qor-field__block > .qor-sortable__button-add"),a=d.find("> .qor-sortable__button-delete"),c=d.find(s);o.hide(),c.hide(),n.find(r).show(),l.show(),a.show()},startMoveItem:function(e){var o=t(e.target),n=this.$element,r=n.find(i).not(".is-delete,.qor-fieldset--new"),l=n.find("> .qor-field__block > .qor-sortable__button-add"),a=r.find("> .qor-sortable__button-delete"),c=r.find(s);if(!r.length)return!1;o.hide(),n.find(d).show(),c.show(),l.hide(),a.hide(),this.initItemOrder()},destroy:function(){this.unbind(),this.$element.removeData(o)}},e.DEFAULTS={},e.OPTION_HTML='<option value="[[selectorPosition]]" [[#isSelected]]selected[[/isSelected]]>[[selectorPosition]] of [[itemTotal]]</option>',e.plugin=function(n){return this.each(function(){var i,r=t(this),d=r.data(o);if(!d){if(/destroy/.test(n))return;r.data(o,d=new e(this,n))}"string"==typeof n&&t.isFunction(i=d[n])&&i.apply(d)})},t(function(){var o='[data-toggle="qor.collection.sortable"]';t("body").data("sortable-collection-loaded")||(t("body").data("sortable-collection-loaded",!0),t(document).on("disable.qor.collection.sortable",function(n){e.plugin.call(t(o,n.target),"destroy")}).on("enable.qor.collection.sortable",function(n){e.plugin.call(t(o,n.target))}).triggerHandler("enable.qor.collection.sortable"))}),e});