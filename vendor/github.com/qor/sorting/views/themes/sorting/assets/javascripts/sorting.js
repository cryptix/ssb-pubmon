"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function o(i,e){this.$element=t(i),this.options=t.extend({},o.DEFAULTS,t.isPlainObject(e)&&e),this.$source=null,this.ascending=!1,this.orderType=0,this.startY=0,this.init()}var i=window.location,e="qor.sorting",n="enable."+e,r="disable."+e,s="change."+e,a="click."+e,d="mousedown."+e,u="mouseup."+e,p="dragstart."+e,f="dragend."+e,l="dragover."+e,c="drop."+e,h="qor-sorting",g="qor-sorting__highlight",v="qor-sorting__hover",y="tbody > tr";return o.prototype={constructor:o,init:function(){var i=this.options,e=this.$element,n=e.find(y),r=0,s=0,a=0,d=void 0;t("body").addClass(h),e.find("tbody .qor-table__actions").append(o.TEMPLATE),n.each(function(o){var e=t(this).find(i.input).data("position");o>0&&(e>d?s++:s--),d=e,a=o}),s===a?r=1:-s===a&&(r=-1),this.$rows=n,this.orderType=r,this.bind()},bind:function(){var o=this.options;this.$element.on(a,o.input,function(){return!1}).on(s,o.input,t.proxy(this.change,this)).on(d,o.toggle,t.proxy(this.mousedown,this)).on(u,t.proxy(this.mouseup,this)).on(p,y,t.proxy(this.dragstart,this)).on(f,y,t.proxy(this.dragend,this)).on(l,y,t.proxy(this.dragover,this)).on(c,y,t.proxy(this.drop,this))},unbind:function(){this.$element.off(s,this.change).off(d,this.mousedown)},change:function(o){var i=this.options,e=this.orderType,n=this.$rows,r=t(o.currentTarget),s=r.closest("tr"),a=s.parent(),d=r.data(),u=d.position,p=parseInt(r.val(),10),f=p>u,l=void 0;return o.stopPropagation(),n.each(function(){var o=t(this),n=o.find(i.input),r=n.data("position");r===p&&(l=o,f?1===e?l.after(s):-1===e&&l.before(s):1===e?l.before(s):-1===e&&l.after(s)),f?r>u&&p>=r&&n.data("position",--r).val(r):u>r&&r>=p&&n.data("position",++r).val(r)}),r.data("position",p),l||(f?1===e?a.append(s):-1===e&&a.prepend(s):1===e?a.prepend(s):-1===e&&a.append(s)),this.sort(s,{url:d.sortingUrl,from:u,to:p}),!1},mousedown:function(o){this.startY=o.pageY,t(o.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(y).prop("draggable",!1)},dragend:function(){t(y).removeClass(v),this.$element.find(y).prop("draggable",!1)},dragstart:function(o){var i=o.originalEvent,e=t(o.currentTarget);e.prop("draggable")&&i.dataTransfer&&(i.dataTransfer.effectAllowed="move",this.$source=e)},dragover:function(o){var i=this.$source;t(y).removeClass(v),t(o.currentTarget).prev("tr").addClass(v),i&&o.currentTarget!==this.$source[0]&&o.preventDefault()},drop:function(o){var i=this.options,e=this.orderType,n=o.pageY>this.startY,r=this.$source,s=void 0,a=void 0,d=void 0,u=void 0,p=void 0,f=void 0;t(y).removeClass(v),r&&o.currentTarget!==this.$source[0]&&(o.preventDefault(),a=t(o.currentTarget),s=r.find(i.input),d=s.data(),u=d.position,p=a.find(i.input).data("position"),f=p>u,this.$element.find(y).each(function(){var o=t(this).find(i.input),e=o.data("position");f?e>u&&p>=e&&o.data("position",--e).val(e):u>e&&e>=p&&o.data("position",++e).val(e)}),s.data("position",p).val(p),f?1===e?a.after(r):-1===e?a.before(r):n?a.after(r):a.before(r):1===e?a.before(r):-1===e?a.after(r):n?a.before(r):a.after(r),this.sort(r,{url:d.sortingUrl,from:u,to:p}))},sort:function(o,i){var e=this.options;i.url&&(this.highlight(o),t.ajax(i.url,{method:"post",data:{from:i.from,to:i.to},success:function(t,i,n){200===n.status&&o.find(e.input).data("position",t).val(t)},error:function(t,o,i){422===t.status?window.alert(t.responseText):window.alert([o,i].join(": "))}}))},highlight:function(t){t.addClass(g),setTimeout(function(){t.removeClass(g)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(e)}},o.DEFAULTS={toggle:!1,input:!1},o.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">drag_handle</i></a>',o.plugin=function(i){return this.each(function(){var n=t(this),r=n.data(e),s=void 0;if(!r){if(/destroy/.test(i))return;n.data(e,r=new o(this,i))}"string"==typeof i&&t.isFunction(s=r[i])&&s.apply(r)})},t(function(){if(/sorting\=true/.test(i.search)){var e=".qor-js-table",s={toggle:".qor-sorting__toggle",input:".qor-sorting__position"};t(document).on(r,function(i){o.plugin.call(t(e,i.target),"destroy")}).on(n,function(i){o.plugin.call(t(e,i.target),s)}).trigger("disable.qor.slideout").triggerHandler(n)}}),o});