"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){function t(i,o){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(o)&&o),this.init()}var i=e("body"),o='select[name="QorResource.Widgets"]';return t.prototype={constructor:t,init:function(){this.bind(),this.isNewForm=this.$element.hasClass("qor-layout__widget-new"),!this.isNewForm&&this.$element.find(o).length&&this.addWidgetSlideout(),this.initSelect()},bind:function(){this.$element.on("change.qor.widget","select",this.change.bind(this)).on("click.qor.widget",".qor-widget__new",this.getFormHtml.bind(this)).on("click.qor.widget",".qor-widget__cancel",this.cancelForm.bind(this))},unbind:function(){this.$element.off("change.qor.widget","select",this.change.bind(this)).off("click.qor.widget",".qor-widget__new",this.getFormHtml.bind(this))},initSelect:function(){var t=this.$element,i=t.find("select").filter('[name="QorResource.Widgets"],[name="QorResource.Template"]'),o=e('[name="QorResource.Kind"]'),n=t.data("hint"),r='<h2 class="qor-page__tips">'+n+"</h2>";if(i.closest(".qor-form-section").hide(),i.each(function(){e(this).find("option").filter('[value!=""]').length>=2&&e(this).closest(".qor-form-section").show()}),!this.isNewForm&&!t.find(".qor-bannereditor").length){var s=o.parent().next(".qor-form-section-rows"),l=o.closest(".qor-fieldset"),a=o.closest(".qor-form-section");s.children().length&&l.find(".qor-field__label:visible").length||(s.append(r),t.find(".qor-field__label").not(a.find(".qor-field__label")).is(":visible")||(a.hide(),t.append(r).parent().find(".qor-form__actions").remove()))}},addWidgetSlideout:function(){var t,n,r=this.$element.find(o),s=i.data("tabScopeActive"),l=e(".qor-slideout").is(":visible"),a=r.closest("form"),d=a.data("action-url")||a.prop("action"),c=d&&-1!==d.indexOf("?")?"&":"?";r.find("option").each(function(){var i=e(this),o=i.val();o&&(t=""+d+c+"widget_type="+o,s&&(t=t+"&widget_scope="+s),n=l?"<a href="+t+' style="display: none;" class="qor-widget-'+o+'" data-open-type="slideout" data-url="'+t+'">'+o+"</a>":"<a href="+t+' style="display: none;" class="qor-widget-'+o+'">'+o+"</a>",r.after(n))})},change:function(t){var i=e(t.target),n=i.val(),r=e(".qor-slideout").is(":visible"),s=".qor-widget-"+n,l=e(s),a=l.prop("href");if(i.is(o))return e.fn.qorSlideoutBeforeHide=null,window.onbeforeunload=null,this.isNewForm||(r?l.trigger("click"):location.href=a),!1},getFormHtml:function(i){var o=e(i.target).closest("a"),n=o.data("widget-type"),r=this.$element,s=o.attr("href"),l=r.find(".qor-layout__widget-selector"),a=l.find("select"),d=e(".qor-layout__widget-setting"),c=r.find('[data-section-title="Settings"]'),f=e(t.TEMPLATE_LOADING);return c.length&&(d=c),f.appendTo(d).trigger("enable"),r.find(".qor-slideout__lists-item a").hide(),r.find(".qor-slideout__lists-groupname").hide(),r.find(".qor-layout__widget-actions").show(),e.get(s,function(e){l.find(".qor-layout__widget-name").html(o.data("widget-name")),l.show(),a.val(n).closest(".qor-form-section").hide(),d.html(e).trigger("enable")}).fail(function(){window.alert("server error, please try again!")}),!1},cancelForm:function(){var e=this.$element;e.closest(".qor-bottomsheets").length&&e.closest(".qor-bottomsheets").removeClass("qor-bottomsheets__fullscreen"),e.find(".qor-slideout__lists-item a").show(),e.find(".qor-slideout__lists-groupname").show(),e.find(".qor-layout__widget-actions, .qor-layout__widget-selector").hide(),e.find(".qor-layout__widget-setting").html("")},destroy:function(){this.unbind(),this.$element.removeData("qor.widget")}},t.DEFAULTS={},t.TEMPLATE_LOADING='<div style="text-align: center; margin-top: 30px;"><div class="mdl-spinner mdl-js-spinner is-active qor-layout__bottomsheet-spinner"></div></div>',t.plugin=function(i){return this.each(function(){var o=e(this),n=o.data("qor.widget"),r=void 0;if(!n){if(/destroy/.test(i))return;o.data("qor.widget",n=new t(this,i))}"string"==typeof i&&e.isFunction(r=n[i])&&r.apply(n)})},e(function(){var i='[data-toggle="qor.widget"]';e(document).on("disable.qor.widget",function(o){t.plugin.call(e(i,o.target),"destroy")}).on("enable.qor.widget",function(o){t.plugin.call(e(i,o.target))}).triggerHandler("enable.qor.widget"),e(".qor-page__header .qor-page-subnav__header").length&&e(".mdl-layout__content").addClass("has-subnav")}),t});