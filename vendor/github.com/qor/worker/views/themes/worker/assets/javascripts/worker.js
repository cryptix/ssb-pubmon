"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?r(require("jquery")):r(jQuery)}(function(h){var n="qor.worker",r="enable."+n,e="click."+n,s=".qor-worker-form",i=".qor-worker-form-list",m=".qor-worker--progress",d=".qor-button--back",p=".qor-js-table",g=".is-selected";function w(r){document.querySelector("#qor-worker--progress")&&document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(r)}function v(r,e){this.$element=h(r),this.options=h.extend({},v.DEFAULTS,h.isPlainObject(e)&&e),this.init()}return v.prototype={constructor:v,init:function(){this.bind(),this.formOpened=!1,h(".qor-worker-form--show").length&&(this.formOpened=!0),w(h("#qor-worker--progress").data("progress")),h(".qor-slideout").is(":visible")||h.fn.qorSliderAfterShow.updateWorkerProgress()},bind:function(){this.$element.on(e,".qor-worker--new",this.showForm.bind(this)).on(e,d,this.hideForm.bind(this))},unbind:function(){this.$element.off(e)},hideForm:function(r){r.preventDefault(),this.$element.find(s).find(">li").show().removeClass("current").find("form").addClass("hidden"),h(d).addClass("hidden"),h(i).show(),this.formOpened=!1,window.onbeforeunload=null,h.fn.qorSlideoutBeforeHide=null},showForm:function(r){var e=h(r.target);if(r.preventDefault(),!this.formOpened){var o=e.closest("li"),t=e.closest(s),n=e.closest(i);t.find(">li").hide().removeClass("current"),o.addClass("current").show(),h(d).removeClass("hidden"),o.find(i).hide(),n.show().find("form").removeClass("hidden"),this.formOpened=!0}},destroy:function(){this.unbind(),v.getWorkerProgressIntervId&&window.clearInterval(v.getWorkerProgressIntervId)}},v.DEFAULTS={},v.POPOVERTEMPLATE='<div class="qor-modal fade qor-modal--worker-errors" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="mdl-card mdl-shadow--2dp" role="document">\n            <div class="mdl-card__title">\n              <h2 class="mdl-card__title-text">Process Errors</h2>\n            </div>\n          <div class="mdl-card__supporting-text" id="qor-worker-errors"></div>\n            <div class="mdl-card__actions">\n              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" data-dismiss="modal">close</a>\n            </div>\n          </div>\n        </div>',v.plugin=function(t){return this.each(function(){var r,e=h(this),o=e.data(n);if(!o){if(/destroy/.test(t))return;e.data(n,o=new v(this,t))}"string"==typeof t&&h.isFunction(r=o[t])&&r.apply(o)})},h.fn.qorSliderAfterShow.updateWorkerProgress=function(r){h(".workers-log-output").length&&(v.getWorkerProgressIntervId=window.setInterval(v.updateWorkerProgress,2e3,r))},v.updateTableStatus=function(r){var e=h(p).find(g),o=h(m).data().statusName;e.find('td[data-heading="'+o+'"]').find(".qor-table__content").html(r)},v.isScrollToBottom=function(r){return r.clientHeight+r.scrollTop<=r.scrollHeight},v.updateWorkerProgress=function(r){var e=r,l=h(".workers-log-output"),a=h(".qor-worker--progress-value"),u=h(".qor-worker--progress-status"),o=h(m),t=h(p).find(g),f=["killed","exception","cancelled","scheduled"];if(l.length){if(o.length)var n=o.data();if(t.length&&n&&n.statusName)var c=t.find('td[data-heading="'+n.statusName+'"]').find(".qor-table__content").html();if(o.length&&o.length&&-1==f.indexOf(n.status))return 100<=n.progress?(window.clearInterval(v.getWorkerProgressIntervId),v.updateTableStatus(n.status),h(".qor-workers-abort").addClass("hidden"),void h(".qor-workers-rerun").removeClass("hidden")):void h.ajax({url:e,method:"GET",dataType:"html",processData:!1,contentType:!1}).done(function(r){var e=h(r),o=e.find(m).data(),t=o.progress,n=o.status,s=-1!=f.indexOf(n);a.html(t),u.html(n),s&&u.addClass("highlight"),w(t);var i=h.trim(e.find(".workers-log-output").html()),d=e.find(".workers-error-output");v.isScrollToBottom(l[0])?l.html(i).scrollTop(l[0].scrollHeight):l.html(i),d.length&&h(".workers-error-output").html(d.html()),c!=n&&v.updateTableStatus(n),(100<=t||s)&&(window.clearInterval(v.getWorkerProgressIntervId),h(".qor-workers-abort").addClass("hidden"),h(".qor-workers-rerun").removeClass("hidden"),h(".qor-worker--progress-result").html(e.find(".qor-worker--progress-result").html()))});window.clearInterval(v.getWorkerProgressIntervId)}},h(function(){var e='[data-toggle="qor.workers"]';h(document).on("disable.qor.worker",function(r){v.plugin.call(h(e,r.target),"destroy")}).on(r,function(r){v.plugin.call(h(e,r.target))}).triggerHandler(r)}),v});