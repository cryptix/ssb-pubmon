"use strict";$.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var a=this,l={};if(l.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table",in:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},l.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},void 0!==this.opts.tableClassNames){var e=this.opts.tableClassNames.split(";");this.table.tableClassNames=[],e.forEach(function(e){if(2==(e=e.split(",")).length){a.table.tableClassNames.push(e[0]);var t={title:e[1],func:a.table.setTableComponent.bind(a,e[0]),observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}};l[e[1]]=t}}),l.clear_styles={title:"Clear table styles",func:this.table.clearTableComponent,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}var t=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(t,l)},setTableComponent:function(e){var t=this.table.getTable();t&&(this.table.clearTableComponent(),t.addClass(e))},clearTableComponent:function(){var e=this.table.getTable();e&&e.removeClass(this.table.tableClassNames.toString().replace(/,/g," "))},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var e=$("<div>"),t=$("<table />"),a=0;a<2;a++){for(var l=$("<tr>"),i=0;i<3;i++){var r=$("<td>"+this.opts.invisibleSpace+"</td>");0===a&&0===i&&r.append(this.marker.get()),$(l).append(r)}t.append(l)}e.append(t);var n=e.html();this.buffer.set();var s=this.selection.current();0!==$(s).closest("li",this.core.editor()[0]).length?$(s).closest("ul, ol").first().after(n):(this.air.collapsed(),this.insert.html(n)),this.selection.restore(),this.core.callback("insertedTable",t)}},getTable:function(){var e=$(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(e)&&(0!==e.length&&e)},restoreAfterDelete:function(e){this.selection.restore(),e.find("span.redactor-selection-marker").remove()},deleteTable:function(){var e=this.table.getTable();if(e){this.buffer.set();var t=e.next();this.opts.linebreaks||0===t.length?this.caret.after(e):this.caret.start(t),e.remove()}},deleteRow:function(){var e=this.table.getTable();if(e){var t=$(this.selection.current());this.buffer.set();var a=t.closest("tr"),l=a.prev().length?a.prev():a.next();if(l.length){var i=l.children("td, th").first();i.length&&i.prepend(this.marker.get())}a.remove(),this.table.restoreAfterDelete(e)}},deleteColumn:function(){var e=this.table.getTable();if(e){this.buffer.set();var i=$(this.selection.current()).closest("td, th")[0].cellIndex;e.find("tr").each($.proxy(function(e,t){var a=$(t),l=i-1<0?i+1:i-1;0===e&&a.find("td, th").eq(l).prepend(this.marker.get()),a.find("td, th").eq(i).remove()},this)),this.table.restoreAfterDelete(e)}},addHead:function(){var e=this.table.getTable();if(e)if(this.buffer.set(),0===e.find("thead").length){var t=e.find("tr").first().clone();t.find("td").replaceWith($.proxy(function(){return $("<th>").html(this.opts.invisibleSpace)},this));var a=$("<thead></thead>").append(t);e.prepend(a)}else this.table.deleteHead()},deleteHead:function(){var e=this.table.getTable();if(e){var t=e.find("thead");0!==t.length&&(this.buffer.set(),t.remove())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(e){if(this.table.getTable()){this.buffer.set();var t=$(this.selection.current()).closest("tr"),a=t.clone();a.find("th").replaceWith(function(){var e=$("<td>");return e[0].attributes=this.attributes,e.append($(this).contents())}),a.find("td").html(this.opts.invisibleSpace),"after"===e?t.after(a):t.before(a)}},addColumn:function(i){var e=this.table.getTable();if(e){var r=0,t=$(this.selection.current());this.buffer.set();var a=t.closest("tr"),l=t.closest("td, th");a.find("td, th").each($.proxy(function(e,t){$(t)[0]===l[0]&&(r=e)},this)),e.find("tr").each($.proxy(function(e,t){var a=$(t).find("td, th").eq(r),l=a.clone();l.html(this.opts.invisibleSpace),"after"===i?a.after(l):a.before(l)},this))}}}};