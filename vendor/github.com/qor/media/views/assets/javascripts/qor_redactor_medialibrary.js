"use strict";$.Redactor.prototype.medialibrary=function(){return{init:function(){var e=this.button.add("medialibrary","MediaLibrary");this.button.addCallback(e,this.medialibrary.addMedialibrary),this.button.setIcon(e,'<i class="material-icons">photo_library</i>'),$(document).on("reload.qor.bottomsheets",".qor-bottomsheets__mediabox",this.medialibrary.initItem)},addMedialibrary:function(){var e,i=this.$element,t={selectModal:"mediabox",maxItem:"1"},o=i.data().redactorSettings.medialibraryUrl;this.medialibrary.BottomSheets=e=$("body").data("qor.bottomsheets"),t.url=o,e.open(t,this.medialibrary.handleMediaLibrary)},handleMediaLibrary:function(e){var i={onSelect:this.medialibrary.handleResults,onSubmit:this.medialibrary.handleResults};this.medialibrary.$bottomsheets=e,e.qorSelectCore(i).addClass("qor-bottomsheets__mediabox"),this.medialibrary.initItem()},initItem:function(){var e,i,t=$(".qor-bottomsheets").find("tbody tr");t.each(function(){e=$(this),i=e.find(".qor-table--ml-slideout p img").first(),e.find(".qor-table__actions").remove(),i.length&&(e.find(".qor-table--medialibrary-item").css("background-image","url("+i.prop("src")+")"),i.parent().remove())})},handleResults:function(e){var i=/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/,t=e.MediaOption;"video_link"==e.SelectedType||t.Video||t.URL.match(i)?this.medialibrary.insertVideo(e):this.medialibrary.insertImage(e),this.medialibrary.$bottomsheets.remove(),$(".qor-bottomsheets").is(":visible")||$("body").removeClass("qor-bottomsheets-open")},insertVideo:function(e){this.opts.mediaContainerClass=void 0===this.opts.mediaContainerClass?"qor-video-container":this.opts.mediaContainerClass;var i,t,o,r,a,s,d,n={},m=this.opts.mediaContainerClass,l=this.opts.regexps.linkyoutube,c=this.opts.regexps.linkvimeo,h=/http?:\/\/(www\.)|(v\.)youku.com/,b=/(\/id_)(\w+)/,p=this.selection.$currentTag,u=/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/,g=(Math.random()+1).toString(36).substring(7),y="qor-video-"+g,v=e.MediaOption,f=v.Description;o='<figure class="'+m+'"><iframe title="'+f+'" width="100%" height="380px" src="',r='" frameborder="0" allowfullscreen></iframe><figcaption>'+f+"</figcaption></figure>","video_link"==e.SelectedType?(t=v.Video,t.match(l)&&(a="youtube",i=t.replace(l,o+"//www.youtube.com/embed/$1"+r)),t.match(c)&&(a="vimeo",i=t.replace(c,o+"//player.vimeo.com/video/$2"+r)),t.match(h)&&b.test(t)&&(a="youku",d=t.match(b)[2],i='<iframe width=100% height=400 src="http://player.youku.com/embed/'+d+'" frameborder=0 "allowfullscreen"></iframe>')):v.URL.match(u)&&(a="uploadedVideo",i='<figure class="'+m+'"><div role="application"><video width="100%" title="'+f+'" aria-label="'+f+'" height="380px" controls="controls" aria-describedby="'+y+'" tabindex="0"><source src="'+v.URL+'"></video></div><figcaption id="'+y+'">'+f+"</figcaption></figure>"),i&&(s=$(i).addClass(y),p?p.after(s):this.$editor.prepend(s),this.code.sync(),n.type=a,n.videoLink=t||v.URL,n.videoIdentification=y,n.description=f,n.$editor=this.$editor,n.$element=this.$element,this.$element.trigger("insertedVideo.redactor",[n]))},insertImage:function(e){var i,t=this.selection.$currentTag,o=$("<img>"),r=$("<"+this.opts.imageTag+">"),a=e.MediaOption,s={};i=a.URL.replace(/image\..+\./,"image."),o.attr({src:i,alt:a.Description}),r.append(o),t?t.after(r):this.$editor.prepend(r),this.image.setEditable(o),this.code.sync(),s.description=a.Description,s.$img=r,s.$editor=this.$editor,s.$element=this.$element,this.$element.trigger("insertedImage.redactor",[s])}}};